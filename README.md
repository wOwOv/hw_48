락프리큐

에러
1. Dequeue함수에서 <예외가 throw됨: 읽기 액세스 위반입니다.
datanode이(가) nullptr였습니다.>
ㄴ이때 조사식으로 size확인하니 7이었음...그럼 예외 발생시키는 동안 다른 스레드들이 넣은건가...
ㄴdatanode가 nullptr이었다는건...큐에 아무것도 없었다....
A. 뽑아서 건네줄 노드가 nullptr이었다면 return false하기..
_____________________________해결

(Dequeue trouble shooting 폴더 참조)
2.애초에 5개 인큐 후 5개 디큐하기에 디큐하려고할때 큐가 비어있을 수 없음
그런데 디큐시에 false 리턴하는 경우가 생김
=>c8 12 44 dc 1e 02 71 53노드를 접근하여 이 노드의 next의 data를 뽑아가려고했음.
하지만 그 사이 노드는 이미 다른 스레드가 뽑아가고 메모리풀로 반환되었고 다시 할당되어 tail로 들어가 next가 nullptr을 가리키고 있음.
그래서 큐 사이즈가 0이 아닌데도 데이터 뽑으려는 노드의 next가 nullptr이라 없다고 생각하고 return false한 것..

A? nullptr인지 비교하는게 문제인가..
그냥 nullptr이면 계속 될때까지 빙글빙글 돌리면 저 문제 안 나올 것 같은데..
A.size 한번 확인해서 비어있던 게 아니라면 돌리자

(Enqueue trouble shooting 폴더-2번 폴더 참조)
3. 너무 잘 돌아가길래 중지 눌러보니까 모든 스레드가 인큐 함수 안에서 돌고있음
모든 스레드가 인큐 행위를 못해서 못 벗어나고 있음
1.3810스레드가 tail을 c8 2f b0 06 94 01 e1 36로 저장해두고 퀀텀 내려갔음
2.이후 d83b가 인큐하고 tail을 c8 2f b0 06 94 01 46 37로 변경함.
3.3810이 다시 running되고 tail의 태그를 떼고 포인터의 next가 nullptr이라서 자신이 생성한 노드를 연결했음. 하지만 tail의 풀포인터를 비교하니 현재 포인터와는 달라서 tail을 바꿔주지는 않음
5. 이후 스레드들이 인큐를 시도하지만 tail의 next는 nullptr이 아니라 빙글빙글 돌고있음
=>tail의 포인터를 비교하는게 아닌 tail의 next를 비교하는 것이다보니 tail 자체는 다르지만 연결 되는 경우가 있어서 발생하는 상황

ㄴ노드들이 태그를 들고 있어서 생기는것이기도 하지 않나..?
ㄴ원장님이 말씀하신대로 head만 tag를 갖도록 해도 head와 tail이 모두 더미노드를 가리킬 때 같은 상황이 발생할 수 있음.

A.oldtail을 가져와서 next가 nullptr이 아니면 내가 oldtail의 next를 head로 바꾸고 다시 수행하자

(next가 자기자신 폴더 -2번 폴더 참고)
4.인큐하는 스레드3개가 tail의 next가 nullptr이 아니고 tail자기자신이라 빙글빙글돌고있음..
ㄴ???? 스레드가 b8 db 11 2d 60 01 9e e7 이전 노드를 oldtail로 저장하고 ready
->b8 db 11 2d 60 01 9e e7가 더이상 tail이 아니며 이후 디큐되어 메모리풀로 반환됨
->이후 다른 스레드들이 쭉 돌다가 ????스레드가 다시 running되며 b8 db 11 2d 60 01 9e e7이전 노드의 next가 더이상 nullptr이 아님을 확인하고 oldtail의 next인 b8 db 11 2d 60 01 9e e7를 tail로 바꿈.
->이때1c1c가 b8 db 11 2d 60 01 노드를 할당받고 nullptr로 세팅 후 oldtail의 next가 nullptr임을 보고 자신이 만든 b8 db 11 2d 60 01 9f e7 노드를 연결했음. 하지만 이 oldtail이 결국 자신이 할당 받았던 노드였기에 tail과 tail의 next가 모두 b8 db 11 2d 60 01를 가리키게됨

5. 4를 해결하기 위해 할당받은 노드와 tail이 같다면 할당받은 노드의 next를 nullptr로 미는 행위를 하지 않고 둠. 반복문을 나갈 수 있는 상황이 되면 nullptr 대입하기
=>size를 분명 빼갈 수 있는 사이즈로 봤는데 실제로 들어가면 노드가 없어서 디큐 안에 갇혀있음


해결
{
디큐하러 오자마자 InterlockedDecrement(_size)의 리턴값 봐서 음수면 없는거고 0이상이면 있는거니까 0이상이면 뽑을 수 있을 때까지 빙글빙글 돌기

태그 붙이려고 태그 InterlockedIncrement하는거 뺄 수 있도록하기
ㄴ기존에 있는 태그를 뽑아서 그걸 플러스1

비트시프트 말고 비트 마스크쓰기
}
